#  /etc/rsyslog.conf	Configuration file for rsyslog.
#
#			For more information see
#			/usr/share/doc/rsyslog-doc/html/rsyslog_conf.html
#
#  Default logging rules can be found in /etc/rsyslog.d/50-default.conf


#################
#### MODULES ####
#################

<%
  modules = [ 'imuxsock', 'imklog', 'imfile' ]
  modules << 'omrelp' if @syslog_remote_protocol == 'relp'
  modules << @rsyslog_modules.split(',') if @rsyslog_modules
  modules.flatten!
  modules.uniq!

  modules.each do |mod|
-%>
$ModLoad <%= mod %>
<% end -%>

# provides UDP syslog reception
<% if @rsyslog_udp_enabled == 'yes' -%>
$ModLoad imudp
$UDPServerRun 514
<% else -%>
#$ModLoad imudp
#$UDPServerRun 514
<% end -%>

# provides TCP syslog reception
<% if @rsyslog_tcp_enabled == 'yes' -%>
$ModLoad imtcp
$InputTCPServerRun 514
<% else -%>
#$ModLoad imtcp
#$InputTCPServerRun 514
<% end -%>

# provides RELP syslog reception
<% if @rsyslog_relp_enabled == 'yes' -%>
$ModLoad imrelp
$InputRELPServerRun 2514
<% else -%>
#$ModLoad imrelp
#$InputRELPServerRun 2514
<% end -%>

###########################
#### GLOBAL DIRECTIVES ####
###########################

#
# Use traditional timestamp format.
# To enable high precision timestamps, comment out the following line.
#
<% if @rsyslog_high_precision_timestamps == 'yes' -%>
#$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
<% else -%>
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
<% end -%>

# Filter duplicated messages
<% if @rsyslog_message_reduction == 'off' -%>
$RepeatedMsgReduction <%= @rsyslog_message_reduction %>
<% else -%>
$RepeatedMsgReduction on
<% end -%>

#
# Set the default permissions for all log files.
#
<% if @rsyslog_file_owner -%>
$FileOwner <%= @rsyslog_file_owner %>
<% else -%>
$FileOwner syslog
<% end -%>
<% if @rsyslog_file_group -%>
$FileGroup <%= @rsyslog_file_group %>
<% else -%>
$FileGroup adm
<% end -%>
<% if @rsyslog_file_createmode -%>
$FileCreateMode <%= @rsyslog_file_createmode %>
<% else -%>
$FileCreateMode 0640
<% end -%>
<% if @rsyslog_dir_createmode -%>
$DirCreateMode <%= @rsyslog_dir_createmode %>
<% else -%>
$DirCreateMode 0755
<% end -%>
<% if @rsyslog_umask -%>
$Umask <%= @rsyslog_umask %>
<% else -%>
$Umask 0022
<% end -%>
<% if @rsyslog_priv_droptouser -%>
$PrivDropToUser <%= @rsyslog_priv_droptouser %>
<% else -%>
$PrivDropToUser syslog
<% end -%>
<% if @rsyslog_priv_droptogroup -%>
$PrivDropToGroup <%= rsyslog_priv_droptogroup %>
<% else -%>
$PrivDropToGroup syslog
<% end -%>

#
# Where to place spool files
#
<% if @rsyslog_spool_dir -%>
$WorkDirectory <%= @rsyslog_spool_dir %>
<% else -%>
$WorkDirectory /var/spool/rsyslog
<% end -%>

#
# Include all config files in /etc/rsyslog.d/
#
<% if @rsyslog_include_conf -%>
$IncludeConfig <%= @rsyslog_include_conf %>
<% else -%>
$IncludeConfig /etc/rsyslog.d/*.conf
<% end -%>

