#---------------------BEGIN <%= srvname %> vhost SECTION-----------------
# The Dispatcher doesn't like /website names with periods in them, so gsub to _
/<%= srvname.gsub('.', '_').gsub('-', '_') %>
  {  
/clientheaders
  {
    "*"
  }
/virtualhosts
  {
  <% if default_vhost == true -%>
  <%= "    \"*\"" %>
  <% else -%>
  <%= "    \"#{srvname}\"" %>
  <% end -%>
  }
/renders
<%
  backends  = []
  hosts     = []

  if renders.kind_of?(Array)
    hosts = renders
  else
    if renders =~ /\s*,\s*/
      hosts = renders.split('\s*,\s*')
    else
      hosts = renders.split
    end
  end

  backends = hosts.map do |host|
    if host =~ /:/
      host.split(':')
    else
      [ host, '80' ]
    end
  end
-%>
  {
<% backends.enum_with_index do |v,i| -%>
    /rend<%= i %> { /hostname "<%= v[0] %>" /port "<%= v[1] %>" /timeout "180000" }
<% end -%>
  }
/filter
  {
    /0000 { /glob "*" /type "allow" }
    /0001 { /glob "* /system/*" /type "deny" }
    /0002 { /glob "* /crx*" /type "deny" }
    /0003 { /glob "* /admin/*" /type "deny" }
    /0004 { /glob "* /system/sling/logout*" /type "allow" }
  }

/propagateSyndPost "0"

/cache
  {
  /docroot "<%= docroot %>"

/statfileslevel "0"
      
/allowAuthorized "1"

/rules
  {
    /0000 { /glob "*" /type "deny" }
    /0001 { /glob "*.cached.*" /type "allow" }
    /0002 { /glob "*.js" /type "allow" }
    /0003 { /glob "*.css" /type "allow" }
    /0004 { /glob "*.woff" /type "allow" }
    /0005 { /glob "*.jpg" /type "allow" }
    /0006 { /glob "*.gif" /type "allow" }
    /0007 { /glob "*.png" /type "allow" }
  }

/invalidate
  {
    /0000 { /glob "*" /type "deny" }
  }

  } # Terminates /cache section

/statistics
  {
    /categories
      {
        /html { /glob "*.html" }
        /others { /glob "*" }
	    }
  }
} # Terminates /website section
#----------------------END <%= srvname %> vhost SECTION-------------------
