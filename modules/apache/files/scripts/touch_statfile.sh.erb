#!/bin/bash

function touchevery () {
  if [ -f $1 ]; then
    if [ $(( $(/bin/date +%s) - $(/usr/bin/stat -c %Y $1) )) -gt $2 ]; then
      /usr/bin/touch --date="${2} seconds ago" $1
    fi
  fi
}


for site in $(/bin/ls /mnt/dispatcher); do
  touchevery /mnt/dispatcher/${site}/.stat <%= @apache_dispatcher_statfile_maxage %>
done
